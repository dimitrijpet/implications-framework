// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-GENERATED UNIT TEST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Generated at: {{timestamp}}
// From: {{implClassName}}
// Platform: {{platform}}
// Target Status: {{targetStatus}}
{{#if isVerify}}
// Test Mode: VERIFY (checks UI only, does not induce state)
{{else}}
// Test Mode: INDUCER (performs action + checks UI)
{{/if}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{{#if isPlaywright}}
const { test, expect } = require('@playwright/test');
{{else}}
const { expect } = require('@wdio/globals');
{{/if}}
const TestContext = require('{{testContextPath}}');
const {{implClassName}} = require('./{{implClassName}}.js');
const TestPlanner = require('{{testPlannerPath}}');
{{#if isPlaywright}}
const TestSetup = require('{{testSetupPath}}');
{{/if}}
{{#if hasUIValidation}}
const ExpectImplication = require('{{expectImplicationPath}}');
{{/if}}
{{#if isVerify}}
const NavigationActions = require('{{navigationActionsPath}}');
{{/if}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… PRE-FLIGHT CHECK - Runs BEFORE app starts!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// This fails fast if prerequisites aren't met, saving time
const testDataPath = process.env.TEST_DATA_PATH || "{{defaultTestDataPath}}";

{{#unless isPlaywright}}
// âš¡ Only run pre-flight for WebdriverIO (expensive app launch)
if (!process.env.SKIP_PREFLIGHT_CHECK) {
  console.log('ğŸš€ Running pre-flight check...');
  TestPlanner.preFlightCheck({{implClassName}}, testDataPath);
}
{{/unless}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ ENTITY FIELD REQUIREMENTS (Setup Concerns)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
{{#if meta.requires}}
{{#each meta.requires}}
{{#if (contains @key '.')}}
// âš ï¸  Required: {{@key}} = {{this}}
{{/if}}
{{/each}}
//
// These are NOT separate states - they're runtime requirements.
// Handle them in your test setup or beforeEach() hook.
//
// Example setup:
{{#each meta.requires}}
{{#if (contains @key '.')}}
//   const parts = '{{@key}}'.split('.');
//   if (!testData[parts[0]]) testData[parts[0]] = {};
//   testData[parts[0]][parts[1]] = {{this}};
{{/if}}
{{/each}}
//
// Or use TestSetup helper:
//   await TestSetup.ensure(ctx.data, '{{targetStatus}}');
//
{{/if}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * âœ… EXPORTED FUNCTION - {{actionDescription}}
 * 
 * {{#if isVerify}}
 * This function VERIFIES the "{{targetStatus}}" state by:
 * 1. Loading test data and checking state exists
 * 2. Navigating to relevant screens
 * 3. Validating UI implications on {{platform}} platform
 * 
 * âš ï¸  NOTE: This is a VERIFY test - it does NOT induce the state.
 * The state must already exist (induced by another platform's test).
 * {{else}}
 * This function INDUCES the "{{targetStatus}}" state by:
 * 1. Loading test data
 * 2. Smart navigation (only if needed)
 * 3. Performing the state-inducing action
 * 4. Validating UI implications on {{platform}} platform
 * 5. Saving the state change with delta
 * {{/if}}
 * 
 * @param {string} testDataPath - Path to testData JSON file
 * @param {object} options - Options
{{#if isPlaywright}}
 * @param {Page} options.page - Playwright page object
{{else}}
 * @param {Driver} options.driver - WebdriverIO driver object
{{/if}}
{{#each optionParams}}
 * @param {{type}} options.{{name}} - {{description}}
{{/each}}
 * @returns {Promise<TestContext>} Updated context
 */
const {{actionName}} = async (testDataPath, options = {}) => {
  {{#if isPlaywright}}
  const { page } = options;
  {{else}}
  const { driver } = options;
  {{/if}}
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 1: Load TestData
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ctx = TestContext.load({{implClassName}}, testDataPath);
  
  console.log('\nğŸ¯ Starting: {{actionDescription}}');
  console.log(`   Target Status: {{targetStatus}}`);
  console.log(`   Current Status: ${ctx.data.status || 'Unknown'}`);
  {{#if isVerify}}
  console.log(`   Test Mode: VERIFY (checks only)`);
  {{else}}
  console.log(`   Test Mode: INDUCER (action + checks)`);
  {{/if}}
  
   // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 2: Smart Navigation (only if needed)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{{#if isPlaywright}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸŒ Web/CMS Navigation
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Web apps use URLs for navigation
  console.log('âœ… Browser navigation (handled by Playwright)');
{{else}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ“± Mobile App Navigation
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{{#if hasNavigation}}
  // Using navigation helper: {{navigation.instance}}
  const {{navigation.instance}} = new {{actionDetails.navigationFile}}(config);
  await {{navigation.instance}}.{{navigation.method}};
  console.log('âœ… Navigated using {{navigation.method}}');
{{else}}
  // Mobile apps don't have URLs - navigation is done via UI.
  // Assuming app starts on correct screen or action handles navigation.
  console.log('âœ… Mobile app ready (navigation handled by action)');
{{/if}}
{{/if}}

  {{#if isVerify}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // âš ï¸  VERIFY MODE - State Must Already Exist
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // This is a VERIFICATION-ONLY test for {{platform}} platform.
  // It does NOT induce the state - it only checks UI implications.
  //
  // The state must be induced by another platform's test first:
  {{#if transition}}
  //   Inducer: {{transition.from}} â†’ {{targetStatus}} on [{{join transition.platforms ", "}}] platform(s)
  {{/if}}
  //
  // This test will FAIL if the state is not already "{{targetStatus}}".
  
  if (ctx.data.status !== '{{targetStatus}}') {
    throw new Error(
      `âŒ Verification test failed: State mismatch\n` +
      `   Expected: {{targetStatus}}\n` +
      `   Current: ${ctx.data.status}\n\n` +
      `ğŸ’¡ Run the inducer test first to create this state:\n` +
      {{#if transition}}
      `   Platform(s): {{join transition.platforms ", "}}\n` +
      `   Transition: {{transition.from}} â†’ {{targetStatus}}`
      {{else}}
      `   Check which platform can induce this state.`
      {{/if}}
    );
  }
  
  console.log('âœ… State verified: {{targetStatus}}');
  
  {{/if}}

  {{#unless isVerify}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 3: Determine Action Scope
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {{#if hasEntityLogic}}
  let targets = [];
  let isGlobalAction = false;
  
  // Check if this is entity-based or global
  if (!ctx.data.{{entityName}}s || !Array.isArray(ctx.data.{{entityName}}s) || ctx.data.{{entityName}}s.length === 0) {
    // Global action (affects session/user state)
    console.log('\nâœ… Global state action');
    isGlobalAction = true;
    targets = [{ isGlobal: true }];
  } else {
    // Entity-based action (affects specific {{entityName}}s)
    if (options.indices && Array.isArray(options.indices)) {
      targets = options.indices.map(i => ctx.data.{{entityName}}s[i]);
    } else if (options.index !== undefined) {
      targets = [ctx.data.{{entityName}}s[options.index]];
    } else {
      // Default: first entity matching {{previousStatus}}
      {{#if previousStatus}}
      const matchingEntities = ctx.data.{{entityName}}s.filter(e => e.status === '{{previousStatus}}');
      if (!matchingEntities || matchingEntities.length === 0) {
        // Fall back to global if no matching entities
        console.log('\nâœ… No matching entities, treating as global action');
        isGlobalAction = true;
        targets = [{ isGlobal: true }];
      } else {
        targets = [matchingEntities[0]];
        console.log(`\nâœ… Processing ${targets.length} {{entityName}}(s)...`);
      }
      {{else}}
      targets = [ctx.data.{{entityName}}s[0]];
      console.log(`\nâœ… Processing ${targets.length} {{entityName}}(s)...`);
      {{/if}}
    }
  }
  {{else}}
  // Global state action (no entity filtering needed)
  console.log('\nâœ… Global state action');
  let isGlobalAction = true;
  {{/if}}
  
   // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 4: Perform Action{{#if isInducer}} (INDUCER mode){{else}} (VERIFY mode){{/if}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
{{#if hasNavigation}}
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ§­ NAVIGATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  console.log('\nğŸ§­ Navigating to action screen...');
  await {{navigation.instance}}.{{navigation.method}}({{#each navigation.args}}{{this}}{{#unless @last}}, {{/unless}}{{/each}});
  console.log('âœ… Navigation complete');
  
{{/if}}
{{#if hasActionDetails}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¬ ACTION LOGIC - Generated from actionDetails
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  {{#if actionDetails.imports}}
  // Initialize screen objects
  {{#each actionDetails.imports}}
  const {{className}} = require('{{{relativePath}}}');
  {{#if ../isPlaywright}}
  const {{varName}} = new {{className}}(page, ctx.data.lang || 'en', ctx.data.device || 'desktop');
  {{else}}
  const {{varName}} = new {{className}}(ctx.data.lang || 'en');
  {{/if}}
  {{/each}}
  {{/if}}
  
  console.log('\nğŸ¬ Executing action: {{actionDescription}}');
  
  {{#if actionDetails.steps}}
  {{#each actionDetails.steps}}
  
  // Step {{addOne @index}}: {{description}}
  await {{instance}}.{{method}}({{{args}}});
  
  {{/each}}
  {{/if}}
  
  console.log('âœ… Action steps completed');
  {{else}}
  // TODO: Navigate to the screen where you perform this action
  {{#if navigationExample}}
  {{{navigationExample}}}
  {{else}}
  // await navigateToScreen();
  {{/if}}
  
  // TODO: Perform the state-inducing action
  {{#if actionExample}}
  // Example:
  {{{actionExample}}}
  {{else}}
  {{#if triggerButton}}
  // Example:
  {{#if isPlaywright}}
  // await page.getByRole('button', { name: '{{triggerButton}}' }).click();
  {{else}}
  // await driver.$('~btn{{triggerButton}}').click();
  {{/if}}
  {{/if}}
  {{/if}}
  
  console.log('   âš ï¸  Action logic not implemented - see comments above');
  {{/if}}
  
  console.log('\nâœ… Action completed');
  {{/unless}}
  
  {{#if isVerify}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 3: Navigate to Screens (VERIFY mode)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  // TODO: Add navigation to screens you want to verify
  // Example:
  {{#if isPlaywright}}
  // await NavigationActions.navigateToBookingCalendar(page, ctx.data);
  {{else}}
  // await NavigationActions.navigateToDashboard(driver, ctx.data);
  {{/if}}
  
  console.log('â­ï¸  Navigation to verification screens (implement as needed)');
  {{/if}}
  
  {{#if hasUIValidation}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP {{#if isVerify}}4{{else}}5{{/if}}: Validate UI Implications ({{platform}})
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  console.log('\nğŸ” Validating {{targetStatus}} UI on {{platform}}...');
  
  {{#each validationScreens}}
  {{#if @first}}
  // âœ… Screen from action - auto-validated
  console.log('   ğŸ” Validating {{screenKey}}...');
  
  {{#if pomClassName}}
  const {{pascalCase screenKey}}Screen = require('{{{../actionDetails.imports.[0].relativePath}}}');
  {{#if ../isPlaywright}}
  const {{screenKey}} = new {{pascalCase screenKey}}Screen(page, ctx.data.lang || 'en', ctx.data.device || 'desktop');
  {{else}}
  const {{screenKey}} = new {{pascalCase screenKey}}Screen(ctx.data.lang || 'en');
  {{/if}}
  {{else}}
  {{#if ../actionDetails.imports.[0]}}
  {{#if ../isPlaywright}}
  const {{screenKey}} = new {{../actionDetails.imports.[0].className}}(page, ctx.data.lang || 'en', ctx.data.device || 'desktop');
  {{else}}
  const {{screenKey}} = new {{../actionDetails.imports.[0].className}}(ctx.data.lang || 'en');
  {{/if}}
  {{/if}}
  {{/if}}
  
  await ExpectImplication.validateImplications(
    {{../implClassName}}.mirrorsOn.UI.{{../platformKey}}.{{screenKey}},
    ctx.data,
    {{screenKey}}
  );
  console.log('   âœ… {{screenKey}} validation passed');
  {{else}}
  
  // â­ï¸ TODO: Uncomment and add navigation to {{screenKey}}
  // console.log('   ğŸ” Validating {{screenKey}}...');
  // 
  // // 1. Navigate to {{screenKey}}
  {{#if ../isPlaywright}}
  // await NavigationActions.navigateTo{{pascalCase screenKey}}(page, ctx.data);
  {{else}}
  // await NavigationActions.navigateTo{{pascalCase screenKey}}(driver, ctx.data);
  {{/if}}
  // 
  // // 2. Initialize screen
  {{#if pomClassName}}
  // const {{pascalCase screenKey}}Screen = require('../../../path/to/{{screenKey}}.screen.js');
  {{#if ../isPlaywright}}
  // const {{screenKey}} = new {{pascalCase screenKey}}Screen(page, ctx.data.lang || 'en', ctx.data.device || 'desktop');
  {{else}}
  // const {{screenKey}} = new {{pascalCase screenKey}}Screen(ctx.data.lang || 'en');
  {{/if}}
  {{else}}
  {{#if ../isPlaywright}}
  // const {{screenKey}} = new SomeScreen(page, ctx.data.lang || 'en', ctx.data.device || 'desktop');
  {{else}}
  // const {{screenKey}} = new SomeScreen(ctx.data.lang || 'en');
  {{/if}}
  {{/if}}
  // 
  // // 3. Validate
  // await ExpectImplication.validateImplications(
  //   {{../implClassName}}.mirrorsOn.UI.{{../platformKey}}.{{screenKey}},
  //   ctx.data,
  //   {{screenKey}}
  // );
  // console.log('   âœ… {{screenKey}} validation passed');
  {{/if}}
  {{/each}}
  
  console.log('âœ… All UI validations passed');
  {{/if}}
  
  {{#if isVerify}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 5: Return Context (No State Change in VERIFY mode)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  console.log('âœ… Verification complete - no state change');
  return ctx;  // Return context without saving
  {{else}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 6: Save Changes (Delta) - INDUCER mode only
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  return ctx.executeAndSave(
    '{{changeLogLabel}}',
    '{{testFileName}}',
    async () => {
      const delta = {};
      const now = new Date().toISOString();
      
      {{#if hasDeltaLogic}}
      // âœ¨ Generated delta from entry: assign
      {{#if meta.entity}}
      // âœ… Entity-scoped state change ({{meta.entity}})
      {{#each deltaFields}}
      delta['{{../meta.entity}}.{{name}}'] = {{{value}}};
      {{/each}}
      {{else}}
      {{#if hasEntityLogic}}
      if (isGlobalAction) {
        // Global state change
        {{#each deltaFields}}
        delta.{{name}} = {{{value}}};
        {{/each}}
      } else {
        // Array-based entity change
        for (const target of targets) {
          const entityPath = `{{entityName}}s[${target.index || 0}]`;
          delta[entityPath] = {
        {{#each deltaFields}}
            {{name}}: {{{value}}},
        {{/each}}
          };
        }
      }
      {{else}}
      // Global state change
      {{#each deltaFields}}
      delta.{{name}} = {{{value}}};
      {{/each}}
      {{/if}}
      {{/if}}
      {{else}}
      // TODO: Customize delta based on what changed
      // Example:
      // delta.status = '{{targetStatus}}';
      // delta.{{targetStatus}}At = now;
      {{/if}}
      
      return { delta };
    }
  );
  {{/if}}
};

{{#if hasHelperFunctions}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPER FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{{#each helperFunctions}}
/**
 * {{description}}
 */
async function {{name}}({{params}}) {
  {{#if code}}
  {{code}}
  {{else}}
  // TODO: Implement {{name}}
  throw new Error('Helper function not implemented: {{name}}');
  {{/if}}
}

{{/each}}
{{/if}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEST REGISTRATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const shouldSkipRegistration = process.env.SKIP_UNIT_TEST_REGISTRATION === 'true';

if (!shouldSkipRegistration) {
  {{#if isPlaywright}}
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PLAYWRIGHT TEST REGISTRATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test.describe("UNIT: {{targetStatus}} State Transition ({{platform}} - {{#if isVerify}}VERIFY{{else}}INDUCER{{/if}})", () => {
    test.setTimeout(120000);
    
    const testDataPath = process.env.TEST_DATA_PATH || "{{defaultTestDataPath}}";
    
    test("{{#if isVerify}}Verify{{else}}Execute{{/if}} {{targetStatus}} transition", async ({ page }) => {
      const ctx = TestContext.load({{implClassName}}, testDataPath);
      
      {{#if isVerify}}
      // VERIFY mode - just check state exists
      await TestPlanner.checkState({{implClassName}}, ctx.data, {
        mode: 'verify'
      });
      {{else}}
      // INDUCER mode - auto-execute prerequisites
      await TestPlanner.checkOrThrow({{implClassName}}, ctx.data, { 
        page, 
        testDataPath 
      });
      {{/if}}
      
      const result = await {{actionName}}(testDataPath, { page });
      
      {{#if isInducer}}
      result.save(testDataPath);
      console.log('   ğŸ’¾ State saved to:', testDataPath);
      {{else}}
      console.log('   âœ… Verification complete - no file changes');
      {{/if}}
    });
    
  });
  {{else}}
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // WEBDRIVERIO TEST REGISTRATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  describe("UNIT: {{targetStatus}} State Transition ({{platform}} - {{#if isVerify}}VERIFY{{else}}INDUCER{{/if}})", () => {
    const testDataPath = process.env.TEST_DATA_PATH || "tests/data/shared.json";
    
    it("{{#if isVerify}}Verify{{else}}Execute{{/if}} {{targetStatus}} transition", async () => {
      const ctx = TestContext.load({{implClassName}}, testDataPath);
      
      {{#if isVerify}}
      // VERIFY mode - just check state exists
      await TestPlanner.checkState({{implClassName}}, ctx.data, {
        mode: 'verify'
      });
      {{else}}
      // INDUCER mode - auto-execute prerequisites
      await TestPlanner.checkOrThrow({{implClassName}}, ctx.data, { 
        driver,
        testDataPath 
      });
      {{/if}}
      
      const result = await {{actionName}}(testDataPath, { driver });
      
      {{#if isInducer}}
      result.save(testDataPath);
      console.log('   ğŸ’¾ State saved to:', testDataPath);
      {{else}}
      console.log('   âœ… Verification complete - no file changes');
      {{/if}}
    });
    
  });
  {{/if}}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

module.exports = { {{actionName}} };
