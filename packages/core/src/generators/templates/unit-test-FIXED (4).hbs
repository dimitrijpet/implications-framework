// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-GENERATED UNIT TEST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Generated at: {{timestamp}}
// From: {{implClassName}}
// Platform: {{platform}}
// Target Status: {{targetStatus}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{{#if isPlaywright}}
const { test, expect } = require('@playwright/test');
{{else}}
const { expect } = require('@wdio/globals');
{{/if}}
const TestContext = require('{{testContextPath}}');
const {{implClassName}} = require('./{{implClassName}}.js');
const TestPlanner = require('{{testPlannerPath}}');
{{#if testSetupPath}}
const TestSetup = require('{{testSetupPath}}');
{{/if}}
{{#if hasUIValidation}}
const ExpectImplication = require('{{expectImplicationPath}}');
{{/if}}
{{#if hasPrerequisites}}
{{#each prerequisiteImports}}
const { {{actionName}} } = require('{{path}}');
{{/each}}
{{/if}}

/**
 * âœ… EXPORTED FUNCTION - {{actionDescription}}
 * 
 * This function induces the "{{targetStatus}}" state by:
 * 1. Loading test data
 * 2. Smart navigation (only if needed)
 * 3. Performing the state-inducing action
 * 4. Saving the state change with delta
 * 
 * @param {string} testDataPath - Path to testData JSON file
 * @param {object} options - Options
{{#if isPlaywright}}
 * @param {Page} options.page - Playwright page object
{{/if}}
{{#each optionParams}}
 * @param {{type}} options.{{name}} - {{description}}
{{/each}}
 * @returns {Promise<TestContext>} Updated context
 */
const {{actionName}} = async (testDataPath, options = {}) => {
  {{#if isPlaywright}}
  const { page } = options;
  {{/if}}
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 1: Load TestData
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ctx = TestContext.load({{implClassName}}, testDataPath);
  
  console.log('\nğŸ¯ Starting: {{actionDescription}}');
  console.log(`   Target Status: {{targetStatus}}`);
  console.log(`   Current Status: ${ctx.data.status || 'Unknown'}`);
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 2: Smart Navigation (only if needed)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {{#if isPlaywright}}
  const currentUrl = page.url();
  // âœ… Check if already on app (adjust pattern for your domain)
  const needsNavigation = !currentUrl || 
    (!currentUrl.includes('voyages.leclerc') && 
     !currentUrl.includes('localhost') &&
     !currentUrl.includes('127.0.0.1'));
  
  if (needsNavigation) {
    console.log('ğŸš€ Navigating to application...');
    await TestSetup.navigateToApp(page, ctx.config);
  } else {
    console.log('âœ… Already on application, skipping navigation');
  }
  {{/if}}
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 3: Get Target Entities
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {{#if hasEntityLogic}}
  let targets = [];
  
  if (options.indices && Array.isArray(options.indices)) {
    targets = options.indices.map(i => ctx.data.{{entityName}}s[i]);
  } else if (options.index !== undefined) {
    targets = [ctx.data.{{entityName}}s[options.index]];
  } else {
    {{#if previousStatus}}
    const matchingEntities = ctx.data.{{entityName}}s?.filter(e => e.status === '{{previousStatus}}');
    if (!matchingEntities || matchingEntities.length === 0) {
      throw new Error('âŒ No {{previousStatus}} {{entityName}}s found');
    }
    targets = [matchingEntities[0]];
    {{else}}
    targets = [ctx.data.{{entityName}}s?.[0]];
    {{/if}}
  }
  
  console.log(`\nâœ… Processing ${targets.length} {{entityName}}(s)...`);
  {{/if}}
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 4: Perform Action
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  {{#if hasActionDetails}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¬ ACTION LOGIC - Generated from actionDetails
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{{#if actionDetails.imports}}
// Initialize screen objects
{{#each actionDetails.imports}}
const {{className}} = require('{{relativePath}}');
const {{varName}} = {{constructor}};
{{/each}}

{{/if}}
console.log('\nğŸ¬ Executing action: {{actionDetails.description}}');

{{#if actionDetails.preSteps}}
{{actionDetails.preSteps}}
{{/if}}

{{#each actionDetails.steps}}
// Step {{addOne @index}}: {{description}}
{{#if code}}
{{code}}
{{else if method}}
{{#if instance}}
await {{instance}}.{{method}}({{#each args}}{{#if @first}}{{this}}{{else}}, {{this}}{{/if}}{{/each}});
{{else}}
await {{method}}({{#each args}}{{#if @first}}{{this}}{{else}}, {{this}}{{/if}}{{/each}});
{{/if}}
{{/if}}

{{/each}}

console.log('âœ… Action steps completed');
{{else}}
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ¬ ACTION LOGIC - TODO: Implement State Transition
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //
  {{#if transitionInfo}}
  // This test induces the transition: '{{transitionInfo.fromState}}' â†’ '{{transitionInfo.toState}}'
  //
  {{#if transitionInfo.event}}
  // Event: {{transitionInfo.event}}
  {{/if}}
  // From State: {{transitionInfo.fromState}}
  // To State: {{transitionInfo.toState}}
  //
  {{/if}}
  {{#if suggestedScreens}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ’¡ Suggested Implementation:
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //
  // Based on mirrorsOn.UI.{{platform}}, you'll need these screen objects:
  //
  {{#each suggestedScreens}}
  //   {{addOne @index}}. Initialize {{className}}:
  //      const {{className}} = require('../../screenObjects/{{file}}.js');
  //      const {{instanceName}} = new {{className}}(page, ctx.data.lang || 'en', ctx.data.device || 'desktop');
  //
  {{/each}}
  //   Then perform actions to trigger the state change:
  //      // TODO: Add your action logic here
  //      // Example:
  {{#if navigationExample}}
  {{{navigationExample}}}
  {{/if}}
  {{#if actionExample}}
  {{{actionExample}}}
  {{else}}
  {{#if triggerButton}}
  //      await page.getByRole('button', { name: '{{triggerButton}}' }).click();
  {{/if}}
  {{/if}}
  //
  {{/if}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ“ Once implemented, update {{implClassName}}.js:
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //
  //   static triggeredBy = [{
  //     description: "{{#if transitionInfo.event}}{{transitionInfo.event}}{{else}}Trigger state change{{/if}}",
  //     platform: "{{platform}}",
  //     action: async (testDataPath, options = {}) => {
  //       const { {{actionName}} } = require('./{{testFileName}}');
  //       return {{actionName}}(testDataPath, options);
  //     }
  //   }];
  //
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  console.log('   âš ï¸  Action logic not implemented - see comments above');
  {{/if}}
  
  console.log('\nâœ… Action completed');
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 5: Save Changes (Delta)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return ctx.executeAndSave(
    '{{changeLogLabel}}',
    '{{testFileName}}',
    async () => {
      const delta = {};
      const now = new Date().toISOString();
      
      {{#if hasDeltaLogic}}
      {{#if hasEntityLogic}}
      for (const target of targets) {
        const entityPath = `{{entityName}}s[${target.index || 0}]`;
        delta[entityPath] = {
      {{#each deltaFields}}
          {{name}}: {{value}},
      {{/each}}
        };
      }
      {{else}}
      {{#each deltaFields}}
      delta['{{name}}'] = {{value}};
      {{/each}}
      {{/if}}
      {{else}}
      // delta['status'] = '{{targetStatus}}';
      // delta['{{targetStatus}}At'] = now;
      {{/if}}
      
      return { delta };
    }
  );
};

{{#if hasHelperFunctions}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPER FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{{#each helperFunctions}}
async function {{name}}({{params}}) {
  {{#if code}}
  {{code}}
  {{else}}
  throw new Error('Helper function not implemented: {{name}}');
  {{/if}}
}

{{/each}}
{{/if}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEST REGISTRATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const shouldSkipRegistration = process.env.SKIP_UNIT_TEST_REGISTRATION === 'true';

if (!shouldSkipRegistration) {
  {{#if isPlaywright}}
  test.describe("UNIT: {{testDescription}}", () => {
    test.setTimeout(120000);
    
    const testDataPath = process.env.TEST_DATA_PATH || "{{defaultTestDataPath}}";
    
    {{#each testCases}}
    test("{{description}}", async ({ page }) => {
      // âœ… Load context
      const ctx = TestContext.load({{../implClassName}}, testDataPath);
      
      {{#if ../requiresPrerequisites}}
      // âœ… AUTO-EXECUTE prerequisites if needed
      await TestPlanner.checkOrThrow({{../implClassName}}, ctx.data, { 
        page, 
        testDataPath 
      });
      {{/if}}
      
      // âœ… Call function (handles navigation internally)
      const result = await {{../actionName}}(testDataPath, { 
        page{{#if params}},
        {{params}}{{/if}}
      });
      
      {{#if ../hasUIValidation}}
      await test.step('Validate {{../targetStatus}} State UI ({{../platform}})', async () => {
        {{#if ../useExpectImplication}}
        {{!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             âœ… CLEAN MODE: Using ExpectImplication
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --}}
        {{#each ../validationScreens}}
        console.log('   ğŸ” Validating {{screenKey}}...');
        
        await ExpectImplication.validateImplications(
          {{../../implClassName}}.mirrorsOn.UI.{{../../platform}}.{{screenKey}},
          result.data,
          page
        );
        
        console.log('   âœ… {{screenKey}} validation passed');
        {{/each}}
        
        {{else}}
        {{!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             âš ï¸  FALLBACK MODE: Inline expects (verbose but guaranteed)
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --}}
        {{#each ../validationScreens}}
        {{#if hasFunctions}}
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ¯ {{screenKey}}: Call Functions & Store Results
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const screen = {{pomClassName}} ? new {{pomClassName}}(page) : null;
        
        {{#each functions}}
        // Call: {{signature}}
        const return{{pascalCase name}} = await screen.{{name}}({{#each parameterValues}}{{#if @first}}{{this}}{{else}}, {{this}}{{/if}}{{/each}});
        console.log('   âš¡ Called {{name}}() â†’ stored as return{{pascalCase name}}');
        {{/each}}
        
        {{/if}}
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // âœ… {{screenKey}}: Visibility & Text Checks
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        {{#if hasRegularFields}}
        // Regular fields (direct POM properties)
        {{#each visibleRegularFields}}
        await expect(screen.{{this}}).toBeVisible();
        {{/each}}
        {{#each hiddenRegularFields}}
        await expect(screen.{{this}}).toBeHidden();
        {{/each}}
        {{/if}}
        
        {{#if hasFunctionChecks}}
        // Function-based checks (using stored results)
        {{#each visibleFunctions}}
        await expect(return{{pascalCase this}}).toBeVisible();
        console.log('   âœ… return{{pascalCase this}} is visible');
        {{/each}}
        {{#each hiddenFunctions}}
        await expect(return{{pascalCase this}}).toBeHidden();
        console.log('   âœ… return{{pascalCase this}} is hidden');
        {{/each}}
        {{/if}}
        
        {{#if hasTextChecks}}
        // Text checks
        {{#each textChecks}}
        {{#if isFunction}}
        await expect(return{{pascalCase fieldName}}).toHaveText('{{expectedText}}');
        console.log('   âœ… return{{pascalCase fieldName}} has text: "{{expectedText}}"');
        {{else}}
        await expect(screen.{{fieldName}}).toHaveText('{{expectedText}}');
        console.log('   âœ… {{fieldName}} has text: "{{expectedText}}"');
        {{/if}}
        {{/each}}
        {{/if}}
        
        {{/each}}
        {{/if}}
      });
      {{/if}}
      
      result.save(testDataPath);
      console.log('   ğŸ’¾ State saved to:', testDataPath);
    });
    
    {{/each}}
  });
  {{else}}
  describe("UNIT: {{testDescription}}", () => {
    const testDataPath = process.env.TEST_DATA_PATH || "{{defaultTestDataPath}}";
    
    {{#each testCases}}
    it("{{description}}", async () => {
      await {{../actionName}}(testDataPath{{#if params}}, { {{params}} }{{/if}});
    });
    
    {{/each}}
  });
  {{/if}}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

module.exports = { {{actionName}} };
