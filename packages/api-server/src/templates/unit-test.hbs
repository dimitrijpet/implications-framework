// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-GENERATED UNIT TEST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Generated at: {{timestamp}}
// From: {{implClassName}}
// Platform: {{platform}}
// Target Status: {{targetStatus}}
{{#if usesSection}}
// Section Type: {{sectionType}}
// Scenarios: {{scenarios}}
{{/if}}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{{#if isPlaywright}}
const { test, expect } = require('@playwright/test');
{{else}}
const { expect } = require('@wdio/globals');
{{/if}}
const TestContext = require('{{{testContextPath}}}');
const {{implClassName}} = require('./{{implClassName}}.js');
const TestPlanner = require('{{{testPlannerPath}}}');
{{#if hasValidation}}
const ExpectImplication = require('{{{expectImplicationPath}}}');
{{/if}}
{{#if hasPrerequisites}}
{{#each prerequisiteImports}}
const { {{actionName}} } = require('{{path}}');
{{/each}}
{{/if}}

{{#if usesSection}}
// âœ¨ Section-based test imports
const LoginScreen = require('{{{loginScreenPath}}}');
const AddLandingPageScreen = require('{{{addLandingPagePath}}}');
const {{sectionClass}} = require('{{{sectionPath}}}');
const credentials = require('{{{credentialsPath}}}');
{{/if}}

/**
 * âœ… EXPORTED FUNCTION - {{actionDescription}}
 * 
 * This function induces the "{{targetStatus}}" state by:
 * 1. Loading test data and validating prerequisites
 * 2. {{#if usesSection}}Using Section POM to fill content{{else}}Navigating and performing actions{{/if}}
 * 3. Saving the state change with delta
 * 
 * @param {string} testDataPath - Path to testData JSON file
 * @param {object} options - Options
{{#if isPlaywright}}
 * @param {Page} options.page - Playwright page object
{{/if}}
{{#if usesSection}}
 * @param {string} options.sectionType - Section type ({{sectionTypes}})
 * @param {string} options.scenario - Scenario to use ({{scenarios}})
{{/if}}
{{#each optionParams}}
 * @param {{type}} options.{{name}} - {{description}}
{{/each}}
 * @returns {Promise<TestContext>} Updated context
 */
const {{actionName}} = async (testDataPath, options = {}) => {
  {{#if isPlaywright}}
  const { page{{#if usesSection}}, sectionType = '{{defaultSectionType}}', scenario = '{{defaultScenario}}'{{/if}} } = options;
  {{/if}}
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 1: Load TestData
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ctx = TestContext.load({{implClassName}}, testDataPath);
  
  console.log('\nğŸ¯ Starting: {{actionDescription}}');
  console.log('   Target Status: {{targetStatus}}');
  console.log('   Current Status: ' + (ctx.data.status || 'Unknown'));
  {{#if usesSection}}
  console.log('   Section Type: ' + sectionType);
  console.log('   Scenario: ' + scenario);
  {{/if}}
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 2: Prerequisites Check (CRITICAL!)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {{#if requiresPrerequisites}}
  TestPlanner.checkOrThrow({{implClassName}}, ctx.data);
  {{else}}
  console.log('â„¹ï¸  No prerequisites required for this state');
  {{/if}}
  
  {{#if usesSection}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 3: Login & Navigate (Section Workflow)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  // Login if needed
  if (!page.url().includes('/admin/')) {
    const loginScreen = new LoginScreen(page);
    await page.goto(loginScreen.url, { waitUntil: 'networkidle' });
    await loginScreen.inputUsername.fill(credentials.{{credentialKey}}.username);
    await loginScreen.inputPassword.fill(credentials.{{credentialKey}}.password);
    await Promise.all([
      loginScreen.btnLogin.click(),
      page.waitForNavigation({ waitUntil: 'networkidle' })
    ]);
  }
  
  // Navigate to add page
  const addLandingPage = new AddLandingPageScreen(page);
  await page.goto(addLandingPage.url, {
    waitUntil: 'networkidle',
    timeout: 30000
  });
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 4: Fill Page with Section Content
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  // Determine section class to use
  const SectionClass = {{sectionClass}};
  const section = new SectionClass(page, '{{locale}}');
  
  // Generate page title
  const scenarioConfig = section.constructor.SCENARIOS[scenario];
  const pageTitle = `${sectionType} ${scenarioConfig.titleSuffix} - [REMOVE] ${Date.now().toString().slice(-6)}`;
  
  // Fill page heading
  await addLandingPage.fillField('inputHeadingTitlePanel', pageTitle);
  
  // Add section
  await addLandingPage.clickElement('btnAddSection');
  await addLandingPage.fillField('inputSectionSearchOptions', section.sectionTitle);
  await addLandingPage.selectSectionOption(section.sectionTitle);
  
  // Execute scenario to fill modules
  const sectionData = await section.executeScenario(
    scenario,
    addLandingPage,
    { /* strings if needed */ },
    pageTitle
  );
  
  console.log(`âœ… Filled ${sectionData.modules?.length || 0} modules using ${scenario} scenario`);
  
  {{else}}
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 3: Get Target Entities
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {{#if hasEntityLogic}}
  const {{entityName}} = ctx.data.{{entityName}}s[options.{{entityName}}Index || 0];
  
  if (!{{entityName}}) {
    throw new Error(`No {{entityName}} found at index ${options.{{entityName}}Index || 0}`);
  }
  
  console.log(`   Working with {{entityName}}: ${ctx.data.{{entityName}}.id}`);
  {{/if}}
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 4: Navigate to Screen & Perform Action
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  // TODO: Navigate to the screen where you perform this action
  // Example navigation:
  {{{navigationExample}}}
  
  // TODO: Perform the state-inducing action
  // This is where you interact with the UI to trigger the state change
  // Example:
  {{{actionExample}}}
  
  console.log('   âš ï¸  TODO: Implement action logic');
  console.log('   ğŸ“ Add your navigation and action code here');
  {{/if}}
  
  console.log('\nâœ… Action completed');
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STEP 5: Save Changes (Delta)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return ctx.executeAndSave(
    '{{changeLogLabel}}',
    '{{testFileName}}',
    async () => {
      const delta = {};
      const now = new Date().toISOString();
      
      {{#if usesSection}}
      // âœ¨ Section workflow delta
      delta['status'] = '{{targetStatus}}';
      delta['pageTitle'] = pageTitle;
      delta['sectionType'] = sectionType;
      delta['scenario'] = scenario;
      delta['modules'] = sectionData.modules || [];
      {{else if hasEntityLogic}}
      // Update specific entity in array
      delta['{{entityName}}s'] = ctx.data.{{entityName}}s.map((item, index) => {
        if (index === (options.{{entityName}}Index || 0)) {
          return {
            ...item,
            {{#each deltaFields}}
            {{name}}: {{{value}}}{{#unless @last}},{{/unless}}
            {{/each}}
          };
        }
        return item;
      });
      {{else}}
      // âœ¨ Generated delta from entry: assign
      {{#each deltaFields}}
      delta['{{name}}'] = {{{value}}};
      {{/each}}
      {{/if}}
      
      return { delta };
    }
  );
};


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OPTIONAL TEST REGISTRATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Set SKIP_UNIT_TEST_REGISTRATION=true to skip these tests
// and only use the exported function

const shouldSkipRegistration = process.env.SKIP_UNIT_TEST_REGISTRATION === 'true';

if (!shouldSkipRegistration) {
  {{#if isPlaywright}}
  test.describe("UNIT: {{testDescription}}", () => {
    test.setTimeout(120000);
    
    const testDataPath = process.env.TEST_DATA_PATH || "{{defaultTestDataPath}}";
    
    {{#if usesSection}}
    // âœ¨ Parameterized tests for all scenarios (DRY!)
    const SCENARIOS = {{scenariosJson}};
    
    SCENARIOS.forEach(scenario => {
      test(`Execute {{targetStatus}} transition - ${scenario}`, async ({ page }) => {
        await {{actionName}}(testDataPath, { page, sectionType: '{{defaultSectionType}}', scenario });
        
        {{#if hasValidation}}
        // Validate UI implications (mirrorsOn)
        await test.step('Validate {{targetStatus}} State UI ({{platform}})', async () => {
          const ctx = TestContext.load({{implClassName}}, testDataPath);
          
          {{#each screenValidations}}
          // {{comment}}
          await ExpectImplication.validateImplications(
            {{../implClassName}}.mirrorsOn.UI.{{../platformUpper}}.{{screenKey}},
            ctx.data,
            page
          );
          
          {{/each}}
        });
        {{/if}}
      });
    });
    {{else}}
    test("Execute {{targetStatus}} transition", async ({ page }) => {
      await {{actionName}}(testDataPath, { 
        page{{#if hasEntityLogic}},
        {{entityName}}Index: 0{{/if}}
      });
      
      {{#if hasValidation}}
      // Validate UI implications (mirrorsOn)
      await test.step('Validate {{targetStatus}} State UI ({{platform}})', async () => {
        const ctx = TestContext.load({{implClassName}}, testDataPath);
        
        {{#each screenValidations}}
        // {{comment}}
        await ExpectImplication.validateImplications(
          {{../implClassName}}.mirrorsOn.UI.{{../platformUpper}}.{{screenKey}},
          ctx.data,
          page
        );
        
        {{/each}}
      });
      {{/if}}
    });
    {{/if}}
    
  });
  {{else}}
  describe("UNIT: {{testDescription}}", () => {
    const testDataPath = process.env.TEST_DATA_PATH || "{{defaultTestDataPath}}";
    
    {{#each testCases}}
    it("{{description}}", async () => {
      await {{../actionName}}(testDataPath{{#if params}}, { {{params}} }{{/if}});
    });
    
    {{/each}}
  });
  {{/if}}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

module.exports = { {{actionName}} };
