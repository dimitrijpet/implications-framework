// Auto-generated by Implications Framework
// Created: {{timestamp}}

{{#if composedBehaviors}}
// Composed behaviors
{{#each composedBehaviors}}
const {{className}} = require('{{relativePath}}');
{{/each}}

{{/if}}
{{#if baseClass}}
// Base class
const {{baseClass.className}} = require('{{baseClass.relativePath}}');
{{/if}}
{{#if helpers.needsImplicationHelper}}
const ImplicationHelper = require('../ImplicationsHelper.js');
{{/if}}

/**
 * {{className}}
 * {{#if description}}
 * {{description}}
 * {{/if}}
 * 
 * Status: {{meta.status}}
 * Platform: {{meta.platform}}
 */
class {{className}} {
  
  static xstateConfig = {
    id: '{{stateId}}',
    
    meta: {
      status: '{{meta.status}}',
      {{#if meta.platform}}
      platform: '{{meta.platform}}',
      {{/if}}
      {{#if meta.statusLabel}}
      statusLabel: '{{meta.statusLabel}}',
      {{/if}}
      {{#if meta.triggerButton}}
      triggerButton: '{{meta.triggerButton}}',
      {{/if}}
      {{#if meta.triggerAction}}
      triggerAction: '{{meta.triggerAction}}',
      {{/if}}
      {{#if meta.requiredFields}}
      requiredFields: [{{#each meta.requiredFields}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
      {{/if}}
      {{#if meta.requires}}
      requires: {
        {{#if meta.requires.previousStatus}}
        previousStatus: '{{meta.requires.previousStatus}}'
        {{/if}}
      },
      {{/if}}
      {{#if platforms}}
      setup: [
        {{#each platforms}}
        {
          testFile: '{{testFile}}',
          actionName: '{{actionName}}',
          platform: '{{platform}}'
        }{{#unless @last}},{{/unless}}
        {{/each}}
      ]
      {{else}}
      setup: [{
        testFile: 'tests/implications/bookings/status/{{className}}-{{capitalize meta.platform}}-UNIT.spec.js',
        actionName: '{{#if meta.triggerAction}}{{meta.triggerAction}}{{else}}{{stateId}}{{/if}}',
        platform: '{{meta.platform}}'
      }]
      {{/if}}
    },
    
    on: {
      // TODO: Add state transitions
      // Example:
      // UNDO: 'pending',
      // CANCEL: 'cancelled'
    }
    
    {{#if hasEntry}}
    ,
    entry: {
      status: '{{meta.status}}',
      {{#if meta.statusLabel}}
      statusLabel: '{{meta.statusLabel}}',
      {{/if}}
      {{#if meta.statusCode}}
      statusCode: '{{meta.statusCode}}',
      {{/if}}
      // Add timestamp or other delta fields here
    }
    {{/if}}
  };
  
  static mirrorsOn = {
    {{#if description}}
    description: '{{description}}',
    {{/if}}
    
    triggeredBy: [{
      description: 'Trigger {{meta.status}} state',
      platform: '{{meta.platform}}',
      action: async (testDataPath, options = {}) => {
        const { {{#if meta.triggerAction}}{{meta.triggerAction}}{{else}}{{stateId}}{{/if}} } = require('./{{className}}-{{capitalize meta.platform}}-UNIT.spec.js');
        return {{#if meta.triggerAction}}{{meta.triggerAction}}{{else}}{{stateId}}{{/if}}(testDataPath, options);
      }
    }],
    
    UI: {
      {{#if meta.platform}}
      {{meta.platform}}: {
        {{#if composedBehaviors}}
        // Composed behaviors
        {{#each composedBehaviors}}
        ...{{className}}.{{methodName}}().{{platformKey}},
        {{/each}}
        
        {{/if}}
        {{#if screens}}
        {{#each screens}}
        {{screenKey}}: {{#if extendsBase}}ImplicationHelper.mergeWithBase(
          {{baseClass.className}}.{{platformKey}}.{{screenKey}},
          {
            {{#if description}}
            description: '{{description}}',
            {{/if}}
            {{#if visible}}
            visible: [{{#each visible}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
            {{/if}}
            {{#if hidden}}
            hidden: [{{#each hidden}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]
            {{/if}}
            {{#if checks}}
            {{#if checks.visible}}
            ,
            checks: {
              {{#if checks.visible}}
              visible: [{{#each checks.visible}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]{{#if checks.hidden}},{{/if}}
              {{/if}}
              {{#if checks.hidden}}
              hidden: [{{#each checks.hidden}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]{{#if checks.text}},{{/if}}
              {{/if}}
              {{#if checks.text}}
              text: {
                {{#each checks.text}}
                {{@key}}: '{{this}}'{{#unless @last}},{{/unless}}
                {{/each}}
              }
              {{/if}}
            }
            {{/if}}
            {{/if}}
          }
        ){{else}}[
          {
            screen: (app) => app.{{screenKey}},
            
            prerequisites: [{
              description: 'Navigate to {{screenKey}}',
              setup: async (testData, app) => {
                // TODO: Add navigation logic
              }
            }],
            
            {{#if description}}
            description: '{{description}}',
            {{/if}}
            
            {{#if visible}}
            visible: [{{#each visible}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
            {{/if}}
            
            {{#if hidden}}
            hidden: [{{#each hidden}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
            {{/if}}
            
            {{#if checks}}
            checks: {
              {{#if checks.visible}}
              visible: [{{#each checks.visible}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]{{#if checks.hidden}},{{/if}}
              {{/if}}
              {{#if checks.hidden}}
              hidden: [{{#each checks.hidden}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]{{#if checks.text}},{{/if}}
              {{/if}}
              {{#if checks.text}}
              text: {
                {{#each checks.text}}
                {{@key}}: '{{this}}'{{#unless @last}},{{/unless}}
                {{/each}}
              }
              {{/if}}
            },
            {{/if}}
            
            expect: async (testData, screen) => {
              // TODO: Add custom validation logic
            }
          }
        ]{{/if}}{{#unless @last}},{{/unless}}
        
        {{/each}}
        {{else}}
        // TODO: Add screen definitions
        {{/if}}
      }
      {{/if}}
    }
  };
  
  static meta = {
    status: '{{meta.status}}',
    {{#if meta.platform}}
    platform: '{{meta.platform}}',
    {{/if}}
    {{#if meta.statusLabel}}
    statusLabel: '{{meta.statusLabel}}',
    {{/if}}
    {{#if meta.triggerButton}}
    triggerButton: '{{meta.triggerButton}}'
    {{/if}}
  };
}

module.exports = {{className}};