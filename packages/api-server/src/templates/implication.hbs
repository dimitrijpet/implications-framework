// Auto-generated by Implications Framework
// Created: {{timestamp}}

const { assign } = require('xstate');

class {{className}} {
  static xstateConfig = {
    id: '{{stateId}}',
    {{#if initial}}
    initial: '{{initial}}',
    {{else}}
    initial: 'idle',
    {{/if}}
    
    {{#if context}}
    context: {
     {{#each context}}
  {{@key}}: {{{json this}}},    {{!-- âœ… Use triple braces --}}
  {{/each}}
    },
    {{/if}}
    
    {{#if meta}}
    meta: {
      {{#if meta.status}}
      status: '{{meta.status}}',
      {{/if}}
      {{#if meta.triggerAction}}
      triggerAction: '{{meta.triggerAction}}',
      {{/if}}
      {{#if meta.platform}}
      platform: '{{meta.platform}}',
      {{/if}}
      {{#if meta.triggerButton}}
      triggerButton: '{{meta.triggerButton}}',
      {{/if}}
      {{#if meta.afterButton}}
      afterButton: '{{meta.afterButton}}',
      {{/if}}
      {{#if meta.previousButton}}
      previousButton: '{{meta.previousButton}}',
      {{/if}}
      {{#if meta.statusCode}}
      statusCode: '{{meta.statusCode}}',
      {{/if}}
      {{#if meta.statusNumber}}
      statusNumber: {{meta.statusNumber}},
      {{/if}}
      {{#if meta.notificationKey}}
      notificationKey: '{{meta.notificationKey}}',
      {{/if}}
      {{#if meta.setupActions}}
      setup: {
        setupActions: [{{#each meta.setupActions}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]
      },
      {{/if}}
      {{#if meta.requiredFields}}
      requiredFields: [{{#each meta.requiredFields}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]
      {{/if}}
    },
    {{/if}}
    
    states: {
      idle: {
        on: {
          // TODO: Add transitions here
          // Example: NEXT_EVENT: { target: '#next_state' }
        }
      }
    },
    
    {{#if hasEntry}}
entry: {
  {{#if meta.status}}
  status: '{{meta.status}}',
  statusLabel: '{{meta.statusLabel}}',
  {{/if}}
  // TODO: Add dynamic entry assignments here
  // Example: updatedAt: ({ event }) => event.timestamp
}
{{/if}}
  };

  static mirrorsOn = {
    {{#if description}}
    description: '{{description}}',
    {{/if}}
    
    UI: {
      // TODO: Add UI implications for each platform
      // Example:
      // web: {
      //   screenName: {
      //     visible: ['element1', 'element2'],
      //     hidden: ['element3'],
      //     textChecks: []
      //   }
      // }
    }
  };
  
  {{#if meta}}
  static meta = {
    {{#if meta.status}}status: '{{meta.status}}',{{/if}}
    {{#if meta.platform}}platform: '{{meta.platform}}',{{/if}}
    {{#if category}}category: '{{category}}',{{/if}}
    {{#if description}}description: '{{description}}'{{/if}}
  };
  {{/if}}
}

module.exports = {{className}};