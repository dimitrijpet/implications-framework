// Auto-generated by Implications Framework
// Created: {{timestamp}}

{{#if composedBehaviors}}
// Composed behaviors
{{#each composedBehaviors}}
const {{className}} = require('{{relativePath}}');
{{/each}}

{{/if}}
{{#if baseClass}}
// Base class
const {{baseClass.className}} = require('{{baseClass.relativePath}}');
{{/if}}
{{#if helpers.needsImplicationHelper}}
const ImplicationHelper = require('{{{helpers.implicationHelperPath}}}');
{{/if}}

/**
 * {{className}}
 * {{#if description}}
 * {{description}}
 * {{/if}}
 * 
 * Status: {{meta.status}}
 * Platform: {{meta.platform}}
 */
class {{className}} {{#if baseClass}}extends {{baseClass.className}} {{/if}}{
  
  static xstateConfig = {
    id: '{{stateId}}',
    
    meta: {
      status: '{{meta.status}}',
      {{#if meta.platform}}
      platform: '{{meta.platform}}',
      {{/if}}
      {{#if meta.statusLabel}}
      statusLabel: '{{meta.statusLabel}}',
      {{/if}}
      {{#if meta.triggerButton}}
      triggerButton: '{{meta.triggerButton}}',
      {{/if}}
      {{#if meta.triggerAction}}
      triggerAction: '{{meta.triggerAction}}',
      {{/if}}
      {{#if meta.requiredFields}}
      requiredFields: [{{#each meta.requiredFields}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
      {{/if}}
      {{#if tags}}
      tags: {
        {{#each tags}}
        {{@key}}: '{{this}}'{{#unless @last}},{{/unless}}
        {{/each}}
      },
      {{/if}}
      setup: [
        {{#if setupEntries}}
        {{#each setupEntries}}
        {
          testFile: '{{testFile}}',
          actionName: '{{actionName}}',
          platform: '{{platform}}'{{#if previousStatus}},
          previousStatus: '{{previousStatus}}'{{/if}}{{#if requires}},
          requires: {{{json requires}}}{{/if}}
        }{{#unless @last}},{{/unless}}
        {{/each}}
        {{else}}
        // Setup entries will be added when transitions are created
        {{/if}}
      ]
    },
    
    on: {
      // TODO: Add state transitions
      // Example:
      // UNDO: 'pending',
      // CANCEL: 'cancelled'
    }
    
    {{#if hasEntry}}
    ,
    entry: {
      status: '{{meta.status}}',
      {{#if meta.statusLabel}}
      statusLabel: '{{meta.statusLabel}}',
      {{/if}}
      {{#if meta.statusCode}}
      statusCode: '{{meta.statusCode}}',
      {{/if}}
      // Add timestamp or other delta fields here
    }
    {{/if}}
  };
  
  static mirrorsOn = {
    {{#if description}}
    description: '{{description}}',
    {{/if}}
    
    triggeredBy: [
      {{#if setupEntries}}
      {{#each setupEntries}}
      {
        description: 'Trigger {{../meta.status}} via {{previousStatus}}',
        platform: '{{platform}}',
        action: async (testDataPath, options = {}) => {
          const { {{actionName}} } = require('./{{testFile}}');
          return {{actionName}}(testDataPath, options);
        }
      }{{#unless @last}},{{/unless}}
      {{/each}}
      {{else}}
      {
        description: 'Trigger {{meta.status}} state',
        platform: '{{meta.platform}}',
        action: async (testDataPath, options = {}) => {
          // TODO: Will be updated when transitions are added
          throw new Error('No setup entries defined yet');
        }
      }
      {{/if}}
    ],
    
    UI: {
      {{#if meta.platform}}
      {{meta.platform}}: {
        {{#if screens}}
        {{#each screens}}
        {{@key}}: [{{#if this.[0].extendsBase}}ImplicationHelper.mergeWithBase(
          {{#if ../baseClass}}{{../baseClass.className}}{{else}}BaseBookingImplications{{/if}}.{{../sourcePlatform}}.{{@key}},
          {
            {{#if this.[0].description}}
            description: '{{this.[0].description}}',
            {{/if}}
            {{#if this.[0].visible}}
            visible: [{{#each this.[0].visible}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
            {{/if}}
            {{#if this.[0].hidden}}
            hidden: [{{#each this.[0].hidden}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
            {{/if}}
            {{#if this.[0].functions}}
            functions: {
              {{#each this.[0].functions}}
              {{@key}}: {
                {{#if this.signature}}
                signature: '{{this.signature}}',
                {{/if}}
                {{#if this.parameters}}
                parameters: {
                  {{#each this.parameters}}
                  {{@key}}: '{{this}}'{{#unless @last}},{{/unless}}
                  {{/each}}
                }
                {{/if}}
              }{{#unless @last}},{{/unless}}
              {{/each}}
            },
            {{/if}}
            {{#if this.[0].checks}}
            checks: {
              {{#if this.[0].checks.visible}}
              visible: [{{#each this.[0].checks.visible}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]{{#if this.[0].checks.hidden}},{{/if}}
              {{/if}}
              {{#if this.[0].checks.hidden}}
              hidden: [{{#each this.[0].checks.hidden}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}]{{#if this.[0].checks.text}},{{/if}}
              {{/if}}
              {{#if this.[0].checks.text}}
              text: {
                {{#each this.[0].checks.text}}
                {{@key}}: '{{this}}'{{#unless @last}},{{/unless}}
                {{/each}}
              }
              {{/if}}
            }
            {{/if}}
          },
          { parentClass: {{../className}} }
        )]{{else}}[
          {
            screen: (app) => app.{{@key}},
            
            prerequisites: [{
              description: 'Navigate to {{@key}}',
              setup: async (testData, app) => {
                // TODO: Add navigation logic
              }
            }],
            
            expect: async (testData, screen) => {
              // TODO: Add custom validation logic
            }
          }
        ]{{/if}}{{#unless @last}},{{/unless}}
        
        {{/each}}
        {{else}}
        // TODO: Add screen definitions
        {{/if}}
      }
      {{/if}}
    }
  };
  
  static meta = {
    status: '{{meta.status}}',
    {{#if meta.platform}}
    platform: '{{meta.platform}}',
    {{/if}}
    {{#if meta.statusLabel}}
    statusLabel: '{{meta.statusLabel}}',
    {{/if}}
    {{#if meta.triggerButton}}
    triggerButton: '{{meta.triggerButton}}'
    {{/if}}
  };
}

module.exports = {{className}};